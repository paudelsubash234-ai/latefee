<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Late Fee Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --blue:#0b3c5d;
  --yellow:#f4c430;
  --light:#f2f6fb;
}

body{
  font-family: Arial, sans-serif;
  background:var(--light);
  padding:20px;
}

/* ================= DESKTOP BASE ================= */

.card{
  max-width:850px; /* Widened to accommodate three columns */
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 6px 16px rgba(0,0,0,.15);
  border-top:8px solid var(--yellow);
}

h1{
  margin:0;
  color:var(--blue);
  text-align:center;
  font-size:22px;
}

.sub{
  text-align:center;
  font-size:11px;
  color:#555;
  margin-bottom:18px;
}

label{
  font-weight:bold;
  margin-top:12px;
  display:block;
  color:var(--blue);
  font-size:13px;
}

input,select{
  width:100%;
  height:38px;
  padding:8px;
  margin-top:5px;
  font-size:13px;
  border:1px solid #aaa;
  border-radius:6px;
  box-sizing:border-box;
}

/* ================= OUTPUT SECTION (3-COLUMNS) ================= */

.output-container {
  display: grid;
  grid-template-columns: 1fr 1.8fr 1fr; /* Photo | Results | Photo */
  gap: 15px;
  margin-top: 25px;
  align-items: center;
  display: none; /* Shown via JS calc() */
}

.output{
  padding:16px;
  background:#fffbe6;
  border-radius:10px;
  border:2px solid var(--yellow);
}

.photo-side {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.photo-side img {
  width: 100%;
  max-width: 160px;
  height: auto;
  border-radius: 10px;
  border: 2px solid var(--blue);
  object-fit: cover;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.photo-caption {
  font-size: 11px;
  color: var(--blue);
  margin-top: 6px;
  font-weight: bold;
  text-align: center;
}

.output-title{
  text-align:center;
  font-weight:bold;
  color:var(--blue);
  margin-bottom:12px;
  font-size:16px;
}

.row{
  display:flex;
  justify-content:space-between;
  padding:7px 0;
  border-bottom:1px dashed #ccc;
}

.row span:first-child{ font-size:13px; }
.value{ font-size:14px; font-weight:bold; }
.big-value{ font-size:17px; font-weight:bold; }
#o_dues{ font-size:18px; font-weight:bold; }
#o_premium, #o_latefee, #o_total{ font-size:16px; font-weight:bold; }
.latefee{ color:#b30000; }

.btn{
  margin-top:12px;
  padding:8px 14px;
  background:var(--blue);
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-size:13px;
  width: 100%;
}

.clear-btn{
  display:block;
  margin:10px 0 0 auto;
  width: auto;
}

/* ================= MOBILE UI FIXES ================= */

@media (max-width:650px){
  body { background:#ffffff; padding: 10px; }
  
  /* Stack 3 columns into 1 on mobile */
  .output-container {
    grid-template-columns: 1fr;
  }

  /* Control order: Results first, then photos */
  .output { order: 1; }
  .left-img { order: 2; margin-top: 15px; }
  .right-img { order: 3; margin-top: 10px; }

  /* Perfect Currency Alignment */
  .currency-input {
    position: relative;
    display: flex;
    align-items: center;
  }

  .currency-prefix {
    position: absolute;
    left: 12px;
    height: 38px;
    display: flex;
    align-items: center;
    font-size: 15px;
    font-weight: 600;
    color: #555;
    pointer-events: none;
    margin-top: 5px; /* Matches input's margin-top */
  }

  .currency-input input {
    padding-left: 45px !important;
    font-size: 15px !important;
    font-weight: 600;
  }

  label {
    color: var(--blue);
    font-weight: 700;
    font-size: 14px;
  }
}
</style>
</head>

<body>

<div class="card">
  <h1>Late Fee Calculator</h1>
  <div class="sub">Prepared by Subash Paudel, Testing Purpose</div>

  <label>Due Date (FUP)</label>
  <input type="date" id="fup">

  <label>Premium Amount</label>
  <div class="currency-input">
    <span class="currency-prefix">Rs.</span>
    <input type="number" id="premium">
  </div>

  <label>Mode</label>
  <select id="mode">
    <option value="12">Yearly</option>
    <option value="6">Half-Yearly</option>
    <option value="3">Quarterly</option>
    <option value="1">Monthly</option>
  </select>

  <label>Calculation Date (Optional)</label>
  <input type="date" id="caldate">

  <button class="btn clear-btn" onclick="clearAll()">Clear</button>

  <div class="output-container" id="outputBox">
    
    <div class="photo-side left-img">
      <img src="left-photo.jpg" alt="Left Photo">
      <div class="photo-caption">Subash Paudel</div>
    </div>

    <div class="output">
      <div class="output-title">O/S Particulars</div>
      <div class="row"><span>Formated FUP</span><span class="value" id="o_fup"></span></div>
      <div class="row"><span>Calc. Date</span><span class="value" id="o_cal"></span></div>
      <div class="row"><span>Late Period</span><span class="value" id="o_period"></span></div>
      <div class="row"><span>Dues Count</span><span class="big-value" id="o_dues"></span></div>
      <div class="row"><span>Total Premium</span><span class="big-value" id="o_premium"></span></div>
      <div class="row"><span>Late Fee</span><span class="big-value latefee" id="o_latefee"></span></div>
      <div class="row"><span>Total Req.</span><span class="big-value" id="o_total"></span></div>
      <div class="row"><span>Valid Till</span><span class="value" id="o_valid"></span></div>
      <button class="btn" onclick="downloadPDF()">Download PDF</button>
    </div>

    <div class="photo-side right-img">
      <img src="right-photo.jpg" alt="Right Photo">
      <div class="photo-caption">Contact Designer</div>
    </div>

  </div>
</div>

<script>
const { jsPDF } = window.jspdf;

function fmt(d){
  let x=new Date(d);
  return String(x.getDate()).padStart(2,"0")+"-"+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][x.getMonth()]+"-"+x.getFullYear();
}

function addMonths(date, months){
  let d=new Date(date);
  let day=d.getDate();
  d.setMonth(d.getMonth()+months);
  if(d.getDate()<day) d.setDate(0);
  return d;
}

function monthsRounded15(start,end){
  if(end<start) return -1;
  let m=(end.getFullYear()-start.getFullYear())*12+(end.getMonth()-start.getMonth());
  let anchor=addMonths(start,m);
  let days=(end-anchor)/86400000;
  return m+(days>=15?1:0);
}

function latePeriodText(a,b){
  let d1=new Date(a), d2=new Date(b);
  let y=d2.getFullYear()-d1.getFullYear();
  let m=d2.getMonth()-d1.getMonth();
  let d=d2.getDate()-d1.getDate();
  if(d<0){ m--; d+=new Date(d2.getFullYear(),d2.getMonth(),0).getDate(); }
  if(m<0){ y--; m+=12; }
  return `${y}Y ${m}M ${d}D`;
}

function validTill(fup,cal){
  let md=cal.getDate()-fup.getDate();
  if(md<0) md+=new Date(cal.getFullYear(),cal.getMonth(),0).getDate();
  let base=(md>14)?addMonths(cal,1):new Date(cal);
  base.setDate(base.getDate()+(14-md));
  return base;
}

function calc(){
  let fupInput=document.getElementById("fup").value;
  let premium=Number(document.getElementById("premium").value);
  let interval=Number(document.getElementById("mode").value);
  let calInput=document.getElementById("caldate").value;

  if(!fupInput || !premium) return;

  document.getElementById("outputBox").style.display="grid";

  let fup=new Date(fupInput);
  let cal=calInput?new Date(calInput):new Date();

  document.getElementById("o_fup").innerText=fmt(fup);
  document.getElementById("o_cal").innerText=fmt(cal);
  document.getElementById("o_period").innerText=latePeriodText(fup,cal);

  let totalAmount=0;
  let dues=0;

  for(let i=0;;i++){
    let due=addMonths(fup,i*interval);
    if(due>cal) break;

    dues++;
    let I=monthsRounded15(due,cal);
    if(I<0) continue;
    if(I===0){ totalAmount+=premium; continue; }

    let J=Math.floor(I/6);
    let K=I-6*J;
    let F=premium*Math.pow(1.05,J);
    totalAmount+=F+(F*0.10/12*K);
  }

  let totalPremium=dues*premium;
  totalAmount=Math.round(totalAmount*10)/10;
  let lateFee=Math.round((totalAmount-totalPremium)*10)/10;

  document.getElementById("o_dues").innerText=dues;
  document.getElementById("o_premium").innerText="Rs. "+totalPremium.toLocaleString();
  document.getElementById("o_latefee").innerText="Rs. "+lateFee.toLocaleString();
  document.getElementById("o_total").innerText="Rs. "+totalAmount.toLocaleString();
  document.getElementById("o_valid").innerText=fmt(validTill(fup,cal));
}

function clearAll(){
  document.querySelectorAll("input,select").forEach(e=>e.value="");
  document.getElementById("outputBox").style.display="none";
}

document.querySelectorAll("input,select").forEach(e=>{
  e.addEventListener("change",calc);
});

function downloadPDF(){
  const doc=new jsPDF();
  let y=20;
  doc.setFontSize(16);
  doc.text("Late Fee Calculator",105,y,{align:"center"});
  y+=8;
  doc.setFontSize(10);
  doc.text("Prepared by Subash Paudel",105,y,{align:"center"});
  y+=12;

  const results = [
    ["Formated FUP", document.getElementById("o_fup").innerText],
    ["Calculation Date", document.getElementById("o_cal").innerText],
    ["Late Period", document.getElementById("o_period").innerText],
    ["Dues Count", document.getElementById("o_dues").innerText],
    ["Total Premium", document.getElementById("o_premium").innerText],
    ["Late Fee", document.getElementById("o_latefee").innerText],
    ["Total Amount", document.getElementById("o_total").innerText],
    ["Valid Till", document.getElementById("o_valid").innerText]
  ];

  results.forEach(r=>{
    doc.text(r[0],20,y);
    doc.text(r[1],120,y);
    y+=8;
  });

  doc.save("Calculation_Report.pdf");
}
</script>

</body>
</html>
