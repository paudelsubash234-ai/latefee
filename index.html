<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Late Fee Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --blue:#0b3c5d;
  --yellow:#f4c430;
  --light:#f2f6fb;
}

body{
  font-family: Arial, sans-serif;
  background:var(--light);
  padding:20px;
}

/* ================= DESKTOP BASE ================= */

.card{
  max-width:720px;
  margin:auto;
  background:#fff;
  padding:18px;
  border-radius:12px;
  box-shadow:0 6px 16px rgba(0,0,0,.15);
  border-top:8px solid var(--yellow);
}

h1{
  margin:0;
  color:var(--blue);
  text-align:center;
  font-size:22px;
}

.sub{
  text-align:center;
  font-size:11px;
  color:#555;
  margin-bottom:18px;
}

label{
  font-weight:bold;
  margin-top:12px;
  display:block;
  color:var(--blue);
  font-size:13px;
}

/* Base style for inputs & select */
input, select {
  width: 100%;
  height: 44px;
  font-size: 15px;
  border-radius: 10px;
  border: 1px solid #eee;
  padding: 10px 12px;
  background: #ffffff;
  box-sizing: border-box;
  margin-top: 5px;
  margin-bottom: 15px;
  box-shadow: 0 6px 14px rgba(0,0,0,0.15);
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  
  /* LEFT ALIGNMENT */
  text-align: left;
}

/* FORCING DATE ALIGNMENT (CRITICAL) */
input[type="date"] {
  display: flex;
  align-items: center;
  justify-content: flex-start;
}

input[type="date"]::-webkit-date-and-time-value {
  text-align: left;
  margin: 0;
  width: 100%;
}

/* CUSTOM DROPDOWN ARROW */
select {
  background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/00/svg' viewBox='0 0 24 24' fill='none' stroke='%230b3c5d' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 15px center;
  background-size: 14px;
  padding-right: 40px !important;
}

.output{
  margin-top:22px;
  padding:16px;
  background:#fffbe6;
  border-radius:10px;
  border:2px solid var(--yellow);
  display:none;
}

.output-title{
  text-align:center;
  font-weight:bold;
  color:var(--blue);
  margin-bottom:12px;
  font-size:16px;
}

.row{
  display:flex;
  justify-content:space-between;
  padding:7px 0;
  border-bottom:1px dashed #ccc;
  align-items: center;
}

.row span:first-child{
  font-size:13px;
}

.value{
  font-size:14px;
  font-weight:bold;
}

.big-value{
  font-size:17px;
  font-weight:bold;
}

#o_dues{
  font-size:20px;
  font-weight:bold;
  line-height: 1; /* Prevents height stretch */
}

#o_premium,
#o_latefee,
#o_total{
  font-size:16px;
  font-weight:bold;
}

.latefee{
  color:#b30000;
}

.btn{
  margin-top:12px;
  padding:8px 14px;
  background:var(--blue);
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-size:13px;
  width: 100%;
}

.clear-btn{
  display:block;
  margin:10px 0 0 auto;
  width: auto;
}

/* ================= MOBILE UI ================= */

@media (max-width:600px){
  body{
    background:#ffffff;
  }

  label{
    color:var(--yellow);
    font-weight:700;
    font-size:14px;
  }

  .currency-input{
    position:relative;
  }

  .currency-prefix{
    position:absolute;
    left:14px;
    top:50%;
    transform:translateY(-50%);
    font-weight:600;
    color:#555;
    pointer-events:none;
    z-index: 5;
    margin-top: -5px; /* Adjusting for input margin */
  }

  .currency-input input{
    padding-left:44px;
  }

  .row span:first-child{
    font-size:12px;
  }

  .value{
    font-size:13px;
  }

  #o_premium,
  #o_latefee,
  #o_total{
    font-size:14px;
  }
}
</style>
</head>

<body>

<div class="card">
<h1>Late Fee Calculator</h1>
<div class="sub">Prepared by Subash Paudel for knowledge purpose</div>

<label>Due Date (FUP)</label>
<input type="date" id="fup">

<label>Premium Amount</label>
<div class="currency-input">
  <span class="currency-prefix">Rs.</span>
  <input type="number" id="premium">
</div>

<label>Mode</label>
<select id="mode">
  <option value="12">Yearly</option>
  <option value="6">Half-Yearly</option>
  <option value="3">Quarterly</option>
  <option value="1">Monthly</option>
</select>

<label>Calculation Date (Optional)</label>
<input type="date" id="caldate">

<button class="btn clear-btn" onclick="clearAll()">Clear</button>

<div class="output" id="outputBox">
  <div class="output-title">Premium & Late Fee O/S Particulars</div>

  <div class="row"><span>Formated FUP</span><span class="value" id="o_fup"></span></div>
  <div class="row"><span>Calculation Date</span><span class="value" id="o_cal"></span></div>
  <div class="row"><span>Late Period</span><span class="value" id="o_period"></span></div>

  <div class="row"><span>No. of Dues o/s</span><span class="big-value" id="o_dues"></span></div>
  <div class="row"><span>Total Premium o/s</span><span class="big-value" id="o_premium"></span></div>
  <div class="row"><span>Late Fee o/s</span><span class="big-value latefee" id="o_latefee"></span></div>
  <div class="row"><span>Total Amount Required</span><span class="big-value" id="o_total"></span></div>

  <div class="row"><span>Late Fee Valid Till</span><span class="value" id="o_valid"></span></div>

  <button class="btn" onclick="downloadPDF()">Download PDF</button>
</div>

</div>

<script>
const { jsPDF } = window.jspdf;

function fmt(d){
  let x=new Date(d);
  return String(x.getDate()).padStart(2,"0")+"-"+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][x.getMonth()]+"-"+x.getFullYear();
}

function addMonths(date, months){
  let d=new Date(date);
  let day=d.getDate();
  d.setMonth(d.getMonth()+months);
  if(d.getDate()<day) d.setDate(0);
  return d;
}

function monthsRounded15(start,end){
  if(end<start) return -1;
  let m=(end.getFullYear()-start.getFullYear())*12+(end.getMonth()-start.getMonth());
  let anchor=addMonths(start,m);
  let days=(end-anchor)/86400000;
  return m+(days>=15?1:0);
}

function latePeriodText(a,b){
  let d1=new Date(a), d2=new Date(b);
  let y=d2.getFullYear()-d1.getFullYear();
  let m=d2.getMonth()-d1.getMonth();
  let d=d2.getDate()-d1.getDate();
  if(d<0){ m--; d+=new Date(d2.getFullYear(),d2.getMonth(),0).getDate(); }
  if(m<0){ y--; m+=12; }
  return `${y} Years ${m} Months ${d} Days`;
}

function validTill(fup,cal){
  let md=cal.getDate()-fup.getDate();
  if(md<0) md+=new Date(cal.getFullYear(),cal.getMonth(),0).getDate();
  let base=(md>14)?addMonths(cal,1):new Date(cal);
  base.setDate(base.getDate()+(14-md));
  return base;
}

function calc(){
  let fupVal=document.getElementById("fup").value;
  let premium=Number(document.getElementById("premium").value);
  let interval=Number(document.getElementById("mode").value);
  let calVal=document.getElementById("caldate").value;

  if(!fupVal || !premium) return;

  document.getElementById("outputBox").style.display="block";

  let fup=new Date(fupVal);
  let cal=calVal?new Date(calVal):new Date();

  document.getElementById("o_fup").innerText=fmt(fup);
  document.getElementById("o_cal").innerText=fmt(cal);
  document.getElementById("o_period").innerText=latePeriodText(fup,cal);

  let totalAmount=0;
  let dues=0;

  for(let i=0;;i++){
    let due=addMonths(fup,i*interval);
    if(due>cal) break;

    dues++;
    let I=monthsRounded15(due,cal);
    if(I<0) continue;
    if(I===0){ totalAmount+=premium; continue; }

    let J=Math.floor(I/6);
    let K=I-6*J;
    let F=premium*Math.pow(1.05,J);
    totalAmount+=F+(F*0.10/12*K);
  }

  let totalPremium=dues*premium;
  totalAmount=Math.round(totalAmount*10)/10;
  let lateFee=Math.round((totalAmount-totalPremium)*10)/10;

  document.getElementById("o_dues").innerText=dues;
  document.getElementById("o_premium").innerText="Rs. "+totalPremium.toFixed(2);
  document.getElementById("o_latefee").innerText="Rs. "+lateFee.toFixed(2);
  document.getElementById("o_total").innerText="Rs. "+totalAmount.toFixed(2);
  document.getElementById("o_valid").innerText=fmt(validTill(fup,cal));
}

function clearAll() {
  // 1. Clear the inputs
  document.getElementById("fup").value = "";
  document.getElementById("premium").value = "";
  document.getElementById("caldate").value = "";

  // 2. IMPORTANT: Reset Mode to "12" instead of making it empty
  // This prevents the "unresponsive/freeze" error you were seeing
  document.getElementById("mode").value = "12";

  // 3. Hide the output box since there's no data
  document.getElementById("outputBox").style.display = "none";
}

document.querySelectorAll("input,select").forEach(e=>{
  e.addEventListener("change",calc);
});

function downloadPDF(){
  const doc=new jsPDF();
  let y=20;

  doc.setFontSize(16);
  doc.text("Late Fee Calculator",105,y,{align:"center"});
  y+=8;
  doc.setFontSize(10);
  doc.text("Prepared by Subash Paudel for knowledge purpose",105,y,{align:"center"});
  y+=12;

  [
    ["Formated FUP", document.getElementById("o_fup").innerText],
    ["Calculation Date", document.getElementById("o_cal").innerText],
    ["Late Period", document.getElementById("o_period").innerText],
    ["No. of Dues o/s", document.getElementById("o_dues").innerText],
    ["Total Premium o/s", document.getElementById("o_premium").innerText],
    ["Late Fee o/s", document.getElementById("o_latefee").innerText],
    ["Total Amount Required", document.getElementById("o_total").innerText],
    ["Late Fee Valid Till", document.getElementById("o_valid").innerText]
  ].forEach(r=>{
    doc.text(r[0],20,y);
    doc.text(r[1],120,y);
    y+=8;
  });

  doc.save("Late_Fee_Calculation.pdf");
}
</script>

</body>
</html>

