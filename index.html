<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Late Fee Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Flatpickr (Date Picker) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --blue:#0b3c5d;
  --yellow:#f4c430;
  --light:#f6f8fb;
}

body{
  font-family: Arial, sans-serif;
  background:var(--light);
  padding:20px;
}

.card{
  max-width:760px;
  margin:auto;
  background:#fff;
  padding:22px;
  border-radius:12px;
  box-shadow:0 6px 16px rgba(0,0,0,.12);
  border-top:6px solid var(--yellow);
}

h1{
  margin:0;
  color:var(--blue);
  text-align:center;
  font-size:26px;
}

.sub{
  text-align:center;
  font-size:12px;
  color:#666;
  margin-bottom:20px;
}

label{
  font-size:13px;
  font-weight:600;
  color:#2c3e50;
  margin-top:14px;
  display:block;
}

input, select{
  width:50%;
  padding:4px 8px;
  font-size:13px;
  border:1px solid #bbb;
  border-radius:6px;
  height:32px;
  margin-top:6px;
  box-sizing:border-box;
}

.output{
  margin-top:28px;
  padding:18px;
  background:#fffbe6;
  border-radius:10px;
  border:1.5px solid var(--yellow);
  display:none;
}

.output-title{
  text-align:center;
  font-size:17px;
  font-weight:bold;
  color:var(--blue);
  margin-bottom:14px;
}

.row{
  display:flex;
  justify-content:space-between;
  padding:8px 0;
  border-bottom:1px dashed #ddd;
}

/* Dates & late period */
.value{
  font-size:15px;
  font-weight:bold;
  line-height:1.5;
}

/* Financial values */
.big-value{
  font-size:18px;
  font-weight:bold;
  line-height:1.6;
}

/* Late fee highlight */
.latefee{
  color:#8b0000;
  font-weight:bold;
}

.btn{
  margin-top:14px;
  padding:8px 16px;
  background:var(--blue);
  color:#fff;
  border:none;
  border-radius:6px;
  font-size:14px;
  cursor:pointer;
}

@media (max-width:600px){
  input, select{
    width:50%;
    height:34px;
    font-size:14px;
  }

  .value{ font-size:14px; }
  .big-value{ font-size:16px; }
}
</style>
</head>

<body>
<div class="card">

<h1>Late Fee Calculator</h1>
<div class="sub">Prepared by Subash Paudel for knowledge purpose</div>

<label>Due Date (FUP)</label>
<input type="text" id="fup" placeholder="DD-MMM-YYYY">

<label>Premium Amount</label>
<input type="number" id="premium">

<label>Mode</label>
<select id="mode">
  <option value="12">Yearly</option>
  <option value="6">Half-Yearly</option>
  <option value="3">Quarterly</option>
  <option value="1">Monthly</option>
</select>

<label>Calculation Date (Optional)</label>
<input type="text" id="caldate" placeholder="DD-MMM-YYYY">

<div class="output" id="outputBox">
  <div class="output-title">Premium & Late Fee O/S Particulars</div>

  <div class="row"><span>Formated FUP</span><span class="value" id="o_fup"></span></div>
  <div class="row"><span>Calculation Date</span><span class="value" id="o_cal"></span></div>
  <div class="row"><span>Late Period</span><span class="value" id="o_period"></span></div>

  <div class="row"><span>No. of Dues o/s</span><span class="big-value" id="o_dues"></span></div>
  <div class="row"><span>Total Premium o/s</span><span class="big-value" id="o_premium"></span></div>
  <div class="row"><span>Late Fee o/s</span><span class="big-value latefee" id="o_latefee"></span></div>
  <div class="row"><span>Total Amount Required</span><span class="big-value" id="o_total"></span></div>

  <div class="row"><span>Late Fee Valid Till</span><span class="value" id="o_valid"></span></div>

  <button class="btn" onclick="downloadPDF()">Download PDF</button>
</div>

</div>

<script>
flatpickr("#fup",{dateFormat:"d-M-Y",allowInput:true});
flatpickr("#caldate",{dateFormat:"d-M-Y",allowInput:true});

const { jsPDF } = window.jspdf;

function fmt(d){
  return d.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/ /g,"-");
}

function addMonths(date, m){
  let d=new Date(date); let day=d.getDate();
  d.setMonth(d.getMonth()+m);
  if(d.getDate()<day) d.setDate(0);
  return d;
}

function monthsRounded15(start,end){
  if(end<start) return -1;
  let m=(end.getFullYear()-start.getFullYear())*12+(end.getMonth()-start.getMonth());
  let anchor=addMonths(start,m);
  return m+((end-anchor)/86400000>=15?1:0);
}

function calc(){
  let fup=document.getElementById("fup").value;
  let premium=+document.getElementById("premium").value;
  let interval=+document.getElementById("mode").value;
  let cal=document.getElementById("caldate").value;

  if(!fup||!premium) return;
  document.getElementById("outputBox").style.display="block";

  fup=new Date(fup);
  cal=cal?new Date(cal):new Date();

  o_fup.innerText=fmt(fup);
  o_cal.innerText=fmt(cal);
  o_period.innerText=
    `${cal.getFullYear()-fup.getFullYear()} Years ${cal.getMonth()-fup.getMonth()+12*(cal.getMonth()<fup.getMonth()? -1:0)} Months ${cal.getDate()-fup.getDate()}`;

  let total=0, dues=0;

  for(let i=0;;i++){
    let due=addMonths(fup,i*interval);
    if(due>cal) break;
    dues++;
    let I=monthsRounded15(due,cal);
    if(I<0) continue;
    if(I===0){ total+=premium; continue; }
    let J=Math.floor(I/6), K=I-6*J;
    let F=premium*Math.pow(1.05,J);
    total+=F+(F*0.10/12*K);
  }

  let totalPremium=dues*premium;
  total=Math.round(total*10)/10;
  let lateFee=Math.round((total-totalPremium)*10)/10;

  o_dues.innerText=dues;
  o_premium.innerText="Rs. "+totalPremium.toFixed(2);
  o_latefee.innerText="Rs. "+lateFee.toFixed(2);
  o_total.innerText="Rs. "+total.toFixed(2);
  o_valid.innerText=fmt(new Date(cal.getTime()+14*86400000));
}

function downloadPDF(){
  const doc=new jsPDF();
  let y=20;
  doc.text("Late Fee Calculator",105,y,{align:"center"}); y+=10;
  [["Formated FUP",o_fup.innerText],["Calculation Date",o_cal.innerText],
   ["Late Period",o_period.innerText],["No. of Dues o/s",o_dues.innerText],
   ["Total Premium o/s",o_premium.innerText],["Late Fee o/s",o_latefee.innerText],
   ["Total Amount Required",o_total.innerText],["Late Fee Valid Till",o_valid.innerText]
  ].forEach(r=>{doc.text(r[0],20,y);doc.text(r[1],120,y);y+=8;});
  doc.save("Late_Fee_Calculation.pdf");
}

document.querySelectorAll("input,select").forEach(e=>e.addEventListener("change",calc));
</script>
</body>
</html>
